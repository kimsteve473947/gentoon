generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ì‚¬ìš©ì ëª¨ë¸ (Supabase Authì™€ ì—°ë™)
model User {
  id                String         @id // Supabase Authì˜ user.idë¥¼ ì§ì ‘ ì‚¬ìš©
  email             String         @unique
  name              String?
  avatarUrl         String?        // Supabase í•„ë“œëª… í†µì¼
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  
  // êµ¬ë… ì •ë³´
  subscription      Subscription?
  
  // ìŠ¤í† ë¦¬ì§€ ì •ë³´
  storage           UserStorage?
  
  // ê´€ê³„
  projects          Project[]
  characters        Character[]
  elements          Element[]        // âœ¨ ìš”ì†Œ ì¶”ê°€
  generations       Generation[]
  transactions      Transaction[]
  refunds           Refund[]         // í™˜ë¶ˆ ë‚´ì—­
  projectContexts   ProjectContext[] // í”„ë¡œì íŠ¸ ì»¨í…ìŠ¤íŠ¸
  cashReceipts      CashReceipt[]    // í˜„ê¸ˆì˜ìˆ˜ì¦ ë‚´ì—­
  cashReceiptSettings UserCashReceiptSettings? // í˜„ê¸ˆì˜ìˆ˜ì¦ ì„¤ì •
  referralCode      String         @unique @default(uuid())
  referredBy        String?
  referralRewards   ReferralReward[] @relation("referrer")
  referredRewards   ReferralReward[] @relation("referred")
  
  // ğŸš€ ì„±ëŠ¥ ìµœì í™” ê´€ê³„
  dailyUsageStats   DailyUsageStats[]
  usageCache        UserUsageCache?
  
  // ğŸš€ ê³ ê° ì§€ì›
  inquiries         Inquiry[]
  
  // ğŸš€ ë°°ì¹˜ ìƒì„±
  batchJobs         BatchGenerationJob[]
  
  @@index([id])
  @@index([email])
  @@map("user")
}

// êµ¬ë… ëª¨ë¸
model Subscription {
  id                String         @id @default(uuid())
  userId            String         @unique
  user              User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // í”Œëœ ì •ë³´
  plan              SubscriptionPlan @default(FREE)
  
  // ğŸ”„ í† í° ì‹œìŠ¤í…œ ë¶„ë¦¬ (ì´ë¯¸ì§€ ìƒì„± vs í…ìŠ¤íŠ¸ ìƒì„±)
  imageTokensTotal     Int            @default(0)    // ì´ë¯¸ì§€ ìƒì„± í† í° ì´ëŸ‰
  imageTokensUsed      Int            @default(0)    // ì´ë¯¸ì§€ ìƒì„± í† í° ì‚¬ìš©ëŸ‰
  textTokensTotal      Int            @default(0)    // í…ìŠ¤íŠ¸ ìƒì„± í† í° ì´ëŸ‰ 
  textTokensUsed       Int            @default(0)    // í…ìŠ¤íŠ¸ ìƒì„± í† í° ì‚¬ìš©ëŸ‰
  
  // ğŸ¯ AI ëŒ€ë³¸ ìƒì„± íšŸìˆ˜ ì‹œìŠ¤í…œ (ë‹¨ìˆœ íšŸìˆ˜ ê¸°ë°˜)
  scriptGenerationsTotal Int          @default(15)   // AI ëŒ€ë³¸ ìƒì„± ì›” í•œë„
  scriptGenerationsUsed  Int          @default(0)    // AI ëŒ€ë³¸ ìƒì„± ì‚¬ìš© íšŸìˆ˜
  
  // ğŸš¨ í•˜ìœ„ í˜¸í™˜ì„±ì„ ìœ„í•œ ë ˆê±°ì‹œ í•„ë“œ (deprecated)
  tokensTotal       Int            @default(0)    // @deprecated - imageTokensTotalë¡œ ëŒ€ì²´
  tokensUsed        Int            @default(0)    // @deprecated - imageTokensUsedë¡œ ëŒ€ì²´
  
  maxCharacters     Int            @default(1)
  
  // ê²°ì œ ì •ë³´
  tossBillingKey    String?        // ë¹Œë§í‚¤ (ì •ê¸°ê²°ì œìš©)
  tossCustomerKey   String?        // ê³ ê° ê³ ìœ  í‚¤
  paymentMethod     PaymentMethod? // ê²°ì œìˆ˜ë‹¨ (ì¹´ë“œ/í† ìŠ¤í˜ì´/ì¹´ì¹´ì˜¤í˜ì´)
  tossCustomerId    String?        // í† ìŠ¤ ê³ ê° ID (deprecated)
  tossSubscriptionId String?       // í† ìŠ¤ êµ¬ë… ID (deprecated)
  
  // êµ¬ë… ê¸°ê°„
  currentPeriodStart DateTime      @default(now())
  currentPeriodEnd   DateTime
  cancelAtPeriodEnd  Boolean       @default(false)
  
  // í† í° ì‚¬ìš©ëŸ‰ ì´ˆê¸°í™” ì¶”ì 
  tokensResetDate    DateTime      @default(now()) // í† í°ì´ ë§ˆì§€ë§‰ìœ¼ë¡œ ì´ˆê¸°í™”ëœ ë‚ ì§œ
  nextTokensReset    DateTime      // ë‹¤ìŒ í† í° ì´ˆê¸°í™” ì˜ˆì •ì¼ (ê²°ì œì¼ ê¸°ì¤€ 30ì¼)
  
  // ê´€ê³„
  refunds           Refund[]       // í™˜ë¶ˆ ë‚´ì—­
  
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  
  @@index([userId])
  @@map("subscription")
}

// êµ¬ë… í”Œëœ enum (ìƒˆë¡œìš´ 4í‹°ì–´ êµ¬ì¡°)
enum SubscriptionPlan {
  FREE        // ë¬´ë£Œ: 1ë§Œ í† í°, ìºë¦­í„° 2ê°œ, 8ì¥ ì´ë¯¸ì§€
  STARTER     // ìŠ¤íƒ€í„°: 35ë§Œ í† í°, ìºë¦­í„° 5ê°œ, 270ì¥ ì´ë¯¸ì§€ (29,000ì›)
  PRO         // í”„ë¡œ: 70ë§Œ í† í°, ìºë¦­í„° 10ê°œ, 540ì¥ ì´ë¯¸ì§€ (59,000ì›)
  PREMIUM     // í”„ë¦¬ë¯¸ì—„: 120ë§Œ í† í°, ìºë¦­í„° 20ê°œ, 930ì¥ ì´ë¯¸ì§€ (99,000ì›)
  ADMIN       // ê´€ë¦¬ì: ë¬´ì œí•œ í† í°, ë¬´ì œí•œ ìºë¦­í„°, ë¬´ì œí•œ ì´ë¯¸ì§€
}

// ê²°ì œìˆ˜ë‹¨ enum
enum PaymentMethod {
  CARD        // ì‹ ìš©/ì²´í¬ì¹´ë“œ
  TOSSPAY     // í† ìŠ¤í˜ì´  
  KAKAOPAY    // ì¹´ì¹´ì˜¤í˜ì´
}

// ìºë¦­í„° ëª¨ë¸
model Character {
  id                String         @id @default(uuid())
  userId            String
  user              User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  name              String
  description       String         @db.Text
  styleGuide        String?        @db.Text
  
  // ë ˆí¼ëŸ°ìŠ¤ ì´ë¯¸ì§€ë“¤
  referenceImages   Json           // ì›ë³¸ URL ë°°ì—´
  ratioImages       Json?          // ë¹„ìœ¨ë³„ ì²˜ë¦¬ëœ ì´ë¯¸ì§€ { "1:1": [...], "4:5": [...] }
  thumbnailUrl      String?
  
  // ìºë¦­í„° ë©”íƒ€ë°ì´í„° (ì™¸ëª¨, ì˜ìƒ, ì„±ê²© ë“±)
  metadata          Json?          // visualFeatures, clothing, personality, aliases ë“±
  
  isPublic          Boolean        @default(false)
  isFavorite        Boolean        @default(false)
  
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  
  // ê´€ê³„
  generations       Generation[]
  projects          ProjectCharacter[]
  
  @@index([userId])
  @@map("character")
}

// âœ¨ ìš”ì†Œ(Element) ëª¨ë¸ - ìºë¦­í„°ì™€ ë¹„ìŠ·í•˜ì§€ë§Œ ë¹„ìœ¨ ì²˜ë¦¬ ì—†ìŒ
model Element {
  id                String         @id @default(uuid())
  userId            String
  user              User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  name              String
  description       String?        @db.Text
  
  // ì´ë¯¸ì§€ ì •ë³´ (ë¹„ìœ¨ ì²˜ë¦¬ ì—†ì´ ë‹¨ìˆœ ì €ì¥)
  imageUrl          String         // WebPë¡œ ë³€í™˜ëœ ì›ë³¸ ì´ë¯¸ì§€
  thumbnailUrl      String?        // ì‘ì€ ì¸ë„¤ì¼
  
  // ìš”ì†Œ ë©”íƒ€ë°ì´í„°
  category          String?        // ì‚¬ìš©ì ì •ì˜ ì¹´í…Œê³ ë¦¬
  tags              Json?          // íƒœê·¸ë“¤ ë°°ì—´
  
  isPublic          Boolean        @default(false)
  isFavorite        Boolean        @default(false)
  
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  
  @@index([userId])
  @@map("element")
}

// í”„ë¡œì íŠ¸ ëª¨ë¸
model Project {
  id                String         @id @default(uuid())
  userId            String
  user              User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  title             String
  description       String?        @db.Text
  thumbnailUrl      String?        // ìë™ ìƒì„±ëœ ì¸ë„¤ì¼
  panelCount        Int            @default(0)  // í”„ë¦¬ì»´í“¨íŒ…ëœ íŒ¨ë„ ê°œìˆ˜
  
  // ğŸš€ ì„±ëŠ¥ ìµœì í™” í•„ë“œ ì¶”ê°€
  lastPanelImageUrl String?        // ë§ˆì§€ë§‰ìœ¼ë¡œ ìƒì„±ëœ ì´ë¯¸ì§€
  isEmpty           Boolean        @default(true)   // ë¹ˆ í”„ë¡œì íŠ¸ ì—¬ë¶€
  hasContent        Boolean        @default(false)  // ì‹¤ì œ ì½˜í…ì¸  ìœ ë¬´
  contentSummary    String?        // "3ê°œ íŒ¨ë„, 2ê°œ ì´ë¯¸ì§€" í˜•íƒœ
  lastEditedAt      DateTime       @updatedAt       // ë§ˆì§€ë§‰ í¸ì§‘ ì‹œê°„ (ì •ë ¬ìš©)
  
  status            ProjectStatus  @default(DRAFT)
  isPublic          Boolean        @default(false)
  
  // ì‚­ì œ ê´€ë ¨ (íœ´ì§€í†µ ê¸°ëŠ¥)
  deletedAt         DateTime?      // soft delete
  
  // ë©”íƒ€ë°ì´í„°
  metadata          Json?          // ì¶”ê°€ ì„¤ì • ì •ë³´
  
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  publishedAt       DateTime?
  
  // ê´€ê³„
  panels            Panel[]
  generations       Generation[]
  characters        ProjectCharacter[]
  batchJobs         BatchGenerationJob[]
  projectContexts   ProjectContext[]
  
  // ğŸš€ ìµœì í™”ëœ ì¸ë±ìŠ¤
  @@index([userId, hasContent, lastEditedAt])  // í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸ ì¡°íšŒìš©
  @@index([userId, isEmpty])                   // ë¹ˆ í”„ë¡œì íŠ¸ í•„í„°ë§ìš©
  @@index([userId, deletedAt])                 // íœ´ì§€í†µ ì¡°íšŒìš©
  @@index([status])
  @@map("project")
}

// í”„ë¡œì íŠ¸ ìƒíƒœ enum
enum ProjectStatus {
  DRAFT
  IN_PROGRESS
  COMPLETED
  PUBLISHED
  ARCHIVED
}

// í”„ë¡œì íŠ¸-ìºë¦­í„° ê´€ê³„ í…Œì´ë¸”
model ProjectCharacter {
  id                String         @id @default(uuid())
  projectId         String
  project           Project        @relation(fields: [projectId], references: [id], onDelete: Cascade)
  characterId       String
  character         Character      @relation(fields: [characterId], references: [id], onDelete: Cascade)
  
  createdAt         DateTime       @default(now())
  
  @@unique([projectId, characterId])
  @@index([projectId])
  @@index([characterId])
  @@map("project_character")
}

// íŒ¨ë„ ëª¨ë¸ (ì›¹íˆ°ì˜ ê° ì»·)
model Panel {
  id                String         @id @default(uuid())
  projectId         String
  project           Project        @relation(fields: [projectId], references: [id], onDelete: Cascade)
  
  order             Int            // íŒ¨ë„ ìˆœì„œ
  prompt            String         @db.Text
  imageUrl          String?
  
  // í¸ì§‘ ë°ì´í„° (ë§í’ì„ , í…ìŠ¤íŠ¸ ë“±)
  editData          Json?
  
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  
  // ê´€ê³„
  generation        Generation?
  batchResults      BatchPanelResult[]
  
  @@unique([projectId, order])
  @@index([projectId])
  @@map("panel")
}

// AI ìƒì„± ê¸°ë¡
model Generation {
  id                String         @id @default(uuid())
  userId            String
  user              User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  projectId         String?
  project           Project?       @relation(fields: [projectId], references: [id], onDelete: SetNull)
  
  panelId           String?        @unique
  panel             Panel?         @relation(fields: [panelId], references: [id], onDelete: SetNull)
  
  characterId       String?
  character         Character?     @relation(fields: [characterId], references: [id], onDelete: SetNull)
  
  // ìƒì„± ì •ë³´
  prompt            String         @db.Text
  negativePrompt    String?        @db.Text
  
  // ê²°ê³¼
  imageUrl          String
  thumbnailUrl      String?
  
  // ë©”íƒ€ë°ì´í„°
  model             String         @default("gemini-2-5-flash-image-preview")
  tokensUsed        Int            @default(2)
  generationTime    Int?           // ë°€ë¦¬ì´ˆ
  metadata          Json?
  
  createdAt         DateTime       @default(now())
  
  // ê´€ê³„
  batchResults      BatchPanelResult[]
  
  @@index([userId])
  @@index([projectId])
  @@map("generation")
}

// ê±°ë˜ ë‚´ì—­
model Transaction {
  id                String         @id @default(uuid())
  userId            String
  user              User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type              TransactionType
  amount            Int            // ì› ë‹¨ìœ„
  tokens            Int?           // í† í° ìˆ˜ëŸ‰
  
  // ê²°ì œ ì •ë³´
  tossPaymentKey    String?
  tossOrderId       String?
  
  status            TransactionStatus @default(PENDING)
  description       String?
  
  // ê´€ê³„
  refunds           Refund[]       // í™˜ë¶ˆ ë‚´ì—­
  cashReceipt       CashReceipt?   // í˜„ê¸ˆì˜ìˆ˜ì¦ (1:1 ê´€ê³„)
  
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  
  @@index([userId])
  @@index([status])
  @@map("transaction")
}

// ê±°ë˜ ìœ í˜• enum
enum TransactionType {
  SUBSCRIPTION      // êµ¬ë… ê²°ì œ
  TOKEN_PURCHASE    // í† í° êµ¬ë§¤
  TOKEN_USAGE       // í† í° ì‚¬ìš©
  REFUND           // í™˜ë¶ˆ
  REFERRAL_REWARD  // ì¶”ì²œ ë³´ìƒ
}

// ê±°ë˜ ìƒíƒœ enum
enum TransactionStatus {
  PENDING
  COMPLETED
  FAILED
  CANCELLED
  REFUNDED
}

// ì¶”ì²œì¸ ë³´ìƒ ê¸°ë¡
model ReferralReward {
  id                String         @id @default(uuid())
  
  referrerId        String
  referrer          User           @relation("referrer", fields: [referrerId], references: [id], onDelete: Cascade)
  
  referredId        String
  referred          User           @relation("referred", fields: [referredId], references: [id], onDelete: Cascade)
  
  tokensRewarded    Int            @default(50)
  
  createdAt         DateTime       @default(now())
  
  @@unique([referrerId, referredId])
  @@index([referrerId])
  @@index([referredId])
  @@map("referral_reward")
}

// ğŸš€ ì‚¬ìš©ìë³„ ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©ëŸ‰ ì¶”ì  ëª¨ë¸
model UserStorage {
  id                String         @id @default(uuid())
  userId            String         @unique
  user              User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  usedBytes         Int            @default(0) @map("used_bytes")
  fileCount         Int            @default(0) @map("file_count")
  maxBytes          Int            @default(314572800) @map("max_bytes") // ê¸°ë³¸ 300MB (FREE í”Œëœ)
  
  createdAt         DateTime       @default(now()) @map("created_at")
  updatedAt         DateTime       @updatedAt @map("updated_at")
  
  @@index([userId])
  @@index([usedBytes])
  @@map("user_storage")
}

// ğŸš€ ì¼ì¼ ì‚¬ìš©ëŸ‰ ì§‘ê³„ í…Œì´ë¸” (ì„±ëŠ¥ ìµœì í™”)
model DailyUsageStats {
  id                String         @id @default(uuid())
  userId            String         @map("user_id")
  user              User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  date              DateTime       @db.Date
  tokensUsed        Int            @default(0) @map("tokens_used")
  imagesGenerated   Int            @default(0) @map("images_generated")
  charactersCreated Int            @default(0) @map("characters_created")
  projectsCreated   Int            @default(0) @map("projects_created")
  storageBytesAdded BigInt         @default(0) @map("storage_bytes_added")
  
  createdAt         DateTime       @default(now()) @map("created_at")
  updatedAt         DateTime       @updatedAt @map("updated_at")
  
  @@unique([userId, date], name: "daily_usage_stats_user_date_unique")
  @@index([userId, date(sort: Desc)], name: "daily_usage_stats_user_date_idx")
  @@index([date(sort: Desc)], name: "daily_usage_stats_date_idx")
  @@map("daily_usage_stats")
}

// ğŸš€ ì‚¬ìš©ìë³„ í˜„ì¬ ì‚¬ìš©ëŸ‰ ìºì‹œ í…Œì´ë¸” (ë¹ ë¥¸ ì¡°íšŒë¥¼ ìœ„í•œ)
model UserUsageCache {
  id                  String         @id @default(uuid())
  userId              String         @unique @map("user_id")
  user                User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  currentMonthTokens  Int            @default(0) @map("current_month_tokens")
  currentMonthImages  Int            @default(0) @map("current_month_images")
  totalCharacters     Int            @default(0) @map("total_characters")
  totalProjects       Int            @default(0) @map("total_projects")
  storageUsedBytes    BigInt         @default(0) @map("storage_used_bytes")
  storageLimitBytes   BigInt         @default(314572800) @map("storage_limit_bytes") // ê¸°ë³¸ 300MB (FREE í”Œëœ)
  
  lastCalculated      DateTime       @default(now()) @map("last_calculated")
  createdAt           DateTime       @default(now()) @map("created_at")
  updatedAt           DateTime       @updatedAt @map("updated_at")
  
  @@index([userId], name: "user_usage_cache_user_id_idx")
  @@index([lastCalculated(sort: Desc)], name: "user_usage_cache_last_calculated_idx")
  @@map("user_usage_cache")
}

// ğŸš€ ë¬¸ì˜ì‚¬í•­ ëª¨ë¸ (ê³ ê° ì§€ì›)
model Inquiry {
  id                String         @id @default(uuid())
  userId            String?        @map("user_id")
  user              User?          @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  subject           String
  message           String         @db.Text
  category          InquiryCategory @default(general)
  priority          InquiryPriority @default(normal)
  status            InquiryStatus   @default(pending)
  
  // ê´€ë¦¬ì ì‘ë‹µ
  adminResponse     String?        @db.Text @map("admin_response")
  respondedBy       String?        @map("responded_by") // ê´€ë¦¬ì ì´ë©”ì¼
  respondedAt       DateTime?      @map("responded_at")
  
  // ì¶”ê°€ ì •ë³´
  userEmail         String?        @map("user_email") // ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì—°ë½ì²˜
  userAgent         String?        @map("user_agent") // ë¸Œë¼ìš°ì € ì •ë³´
  ipAddress         String?        @map("ip_address")
  attachments       Json?          // ì²¨ë¶€íŒŒì¼ URL ë°°ì—´ (JSON í˜•íƒœ)
  
  createdAt         DateTime       @default(now()) @map("created_at")
  updatedAt         DateTime       @updatedAt @map("updated_at")
  
  @@index([userId], name: "inquiry_user_id_idx")
  @@index([status], name: "inquiry_status_idx")
  @@index([category], name: "inquiry_category_idx")
  @@index([createdAt(sort: Desc)], name: "inquiry_created_at_idx")
  @@map("inquiry")
}

enum InquiryCategory {
  general     // ì¼ë°˜ ë¬¸ì˜
  technical   // ê¸°ìˆ ì  ë¬¸ì œ
  billing     // ê²°ì œ ê´€ë ¨
  feature     // ê¸°ëŠ¥ ìš”ì²­
  bug         // ë²„ê·¸ ì‹ ê³ 
  account     // ê³„ì • ê´€ë ¨
}

enum InquiryPriority {
  low      // ë‚®ìŒ
  normal   // ë³´í†µ
  high     // ë†’ìŒ
  urgent   // ê¸´ê¸‰
}

enum InquiryStatus {
  pending     // ëŒ€ê¸°
  in_progress // ì²˜ë¦¬ì¤‘
  resolved    // í•´ê²°ë¨
  closed      // ì¢…ë£Œë¨
}

// ğŸ¨ í°íŠ¸ íŒ¨ë°€ë¦¬ ëª¨ë¸ (Canvaê¸‰ ë‹¤ì¤‘ weight ì‹œìŠ¤í…œ)
model FontFamily {
  id                String         @id @default(uuid())
  
  // í°íŠ¸ íŒ¨ë°€ë¦¬ ê¸°ë³¸ ì •ë³´
  nameKo            String         // í•œê¸€ ì´ë¦„ (ì˜ˆ: Noto Sans KR)
  nameEn            String         // ì˜ë¬¸ ì´ë¦„ (ì˜ˆ: Noto Sans KR)
  fontFamily        String         @unique // CSS font-family ê°’
  
  // ì¹´í…Œê³ ë¦¬ ë° ë©”íƒ€ë°ì´í„°
  category          FontCategory   // ê³ ë”•, ëª…ì¡°, ì†ê¸€ì”¨, ì¥ì‹, ì½”ë”©
  provider          String         // ì œê³µì²˜ (ì˜ˆ: êµ¬ê¸€ í°íŠ¸, í•œêµ­ì¶œíŒì¸íšŒì˜)
  licenseType       String         @default("ì‚¬ìš© ê°€ëŠ¥") // ì„ë² ë”© ê¶Œí•œ ìƒíƒœ
  originalUrl       String?        // ì›ë³¸ í˜ì´ì§€ URL
  description       String?        // í°íŠ¸ ì„¤ëª…
  
  // íŒ¨ë°€ë¦¬ ì „ì²´ ì‚¬ìš© í†µê³„
  totalUsageCount   Int            @default(0) // ì „ì²´ ì‚¬ìš© íšŸìˆ˜
  isActive          Boolean        @default(true) // í™œì„±í™” ìƒíƒœ
  isFeatured        Boolean        @default(false) // ì¶”ì²œ í°íŠ¸ ì—¬ë¶€
  
  // ê´€ê³„
  variants          FontVariant[]   // ì´ íŒ¨ë°€ë¦¬ì˜ ëª¨ë“  weight/style variants
  
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  
  @@index([category])
  @@index([isActive])
  @@index([isFeatured])
  @@index([totalUsageCount])
  @@map("font_family")
}

// ğŸ¨ í°íŠ¸ ë°°ë¦¬ì–¸íŠ¸ ëª¨ë¸ (ê° weight/styleë³„ ì„¸ë¶€ ì •ë³´)
model FontVariant {
  id                String         @id @default(uuid())
  
  // íŒ¨ë°€ë¦¬ ê´€ê³„
  fontFamilyId      String
  fontFamily        FontFamily     @relation(fields: [fontFamilyId], references: [id], onDelete: Cascade)
  
  // Weight & Style ì •ë³´
  weight            Int            // 100, 200, 300, 400, 500, 600, 700, 800, 900
  weightName        String         // Thin, ExtraLight, Light, Regular, Medium, SemiBold, Bold, ExtraBold, Black
  style             FontStyle      @default(normal) // normal, italic
  
  // ì›¹í°íŠ¸ CSS ì •ë³´
  cssCode           String         @db.Text // @font-face CSS ì½”ë“œ
  cdnUrl            String?        // CDN URL
  fileUrl           String?        // ì‹¤ì œ í°íŠ¸ íŒŒì¼ URL
  fileFormat        String?        // woff2, woff, ttf ë“±
  
  // ê°œë³„ variant ì‚¬ìš© í†µê³„
  usageCount        Int            @default(0) // ì´ variantì˜ ì‚¬ìš© íšŸìˆ˜
  isActive          Boolean        @default(true) // í™œì„±í™” ìƒíƒœ
  
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  
  @@unique([fontFamilyId, weight, style]) // í•œ íŒ¨ë°€ë¦¬ ë‚´ì—ì„œ weight+style ì¡°í•©ì€ ìœ ë‹ˆí¬
  @@index([fontFamilyId])
  @@index([weight])
  @@index([isActive])
  @@index([usageCount])
  @@map("font_variant")
}

// í°íŠ¸ ì¹´í…Œê³ ë¦¬ enum
enum FontCategory {
  gothic      // ê³ ë”•ì²´
  serif       // ëª…ì¡°/ë°”íƒ•ì²´
  handwriting // ì†ê¸€ì”¨ì²´
  decorative  // ì¥ì‹ì²´
  monospace   // ì½”ë”©ì²´/ê³ ì •í­
}

// í°íŠ¸ ìŠ¤íƒ€ì¼ enum
enum FontStyle {
  normal
  italic
}

// ğŸ“§ ì´ë©”ì¼ ì•Œë¦¼ í…œí”Œë¦¿ ëª¨ë¸
model EmailTemplate {
  id                String         @id @default(uuid())
  
  // í…œí”Œë¦¿ ê¸°ë³¸ ì •ë³´
  name              String         // í…œí”Œë¦¿ ì´ë¦„
  subject           String         // ì´ë©”ì¼ ì œëª© í…œí”Œë¦¿
  content           String         @db.Text // ì´ë©”ì¼ ë‚´ìš© (HTML ì§€ì›)
  type              EmailType      @default(marketing) // í…œí”Œë¦¿ ìœ í˜•
  
  // ë©”íƒ€ë°ì´í„°
  description       String?        // í…œí”Œë¦¿ ì„¤ëª…
  isActive          Boolean        @default(true) // í™œì„±í™” ìƒíƒœ
  
  // ì‚¬ìš© í†µê³„
  sentCount         Int            @default(0) // ë°œì†¡ íšŸìˆ˜
  lastUsedAt        DateTime?      // ë§ˆì§€ë§‰ ì‚¬ìš© ì¼ì‹œ
  
  // ê´€ë¦¬ì ì •ë³´
  createdBy         String?        // ìƒì„±í•œ ê´€ë¦¬ì ì´ë©”ì¼
  updatedBy         String?        // ìˆ˜ì •í•œ ê´€ë¦¬ì ì´ë©”ì¼
  
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  
  // ê´€ê³„
  emails            EmailCampaign[] // ì´ í…œí”Œë¦¿ìœ¼ë¡œ ë°œì†¡í•œ ìº í˜ì¸ë“¤
  
  @@index([type])
  @@index([isActive])
  @@index([sentCount])
  @@map("email_template")
}

// ğŸ“§ ì´ë©”ì¼ ìº í˜ì¸ ëª¨ë¸ (ì‹¤ì œ ë°œì†¡ ê¸°ë¡)
model EmailCampaign {
  id                String         @id @default(uuid())
  
  // ìº í˜ì¸ ê¸°ë³¸ ì •ë³´
  name              String?        // ìº í˜ì¸ ì´ë¦„ (ë‚´ë¶€ ê´€ë¦¬ìš©)
  subject           String         // ì‹¤ì œ ë°œì†¡ëœ ì œëª©
  content           String         @db.Text // ì‹¤ì œ ë°œì†¡ëœ ë‚´ìš©
  
  // ë°œì†¡ ëŒ€ìƒ
  targetType        EmailTargetType // ë°œì†¡ ëŒ€ìƒ ìœ í˜•
  customEmails      String?        @db.Text // ì»¤ìŠ¤í…€ ì´ë©”ì¼ ëª©ë¡ (JSON)
  
  // ë°œì†¡ ìƒíƒœ
  status            EmailStatus    @default(pending) // ë°œì†¡ ìƒíƒœ
  recipientCount    Int            @default(0) // ìˆ˜ì‹ ì ìˆ˜
  sentCount         Int            @default(0) // ì‹¤ì œ ë°œì†¡ ì„±ê³µ ìˆ˜
  failedCount       Int            @default(0) // ë°œì†¡ ì‹¤íŒ¨ ìˆ˜
  
  // ì„±ê³¼ ì§€í‘œ
  deliveredCount    Int            @default(0) // ë°°ë‹¬ ì„±ê³µ ìˆ˜
  openedCount       Int            @default(0) // ì—´ëŒ ìˆ˜
  clickedCount      Int            @default(0) // í´ë¦­ ìˆ˜
  bounceCount       Int            @default(0) // ë°˜ì†¡ ìˆ˜
  
  // í…œí”Œë¦¿ ì—°ê²°
  templateId        String?        // ì‚¬ìš©í•œ í…œí”Œë¦¿ ID (ì—†ìœ¼ë©´ ì§ì ‘ ì‘ì„±)
  template          EmailTemplate? @relation(fields: [templateId], references: [id], onDelete: SetNull)
  
  // ë°œì†¡ ì‹œê°„
  scheduledAt       DateTime?      // ì˜ˆì•½ ë°œì†¡ ì‹œê°„
  sentAt            DateTime?      // ì‹¤ì œ ë°œì†¡ ì‹œê°„
  completedAt       DateTime?      // ë°œì†¡ ì™„ë£Œ ì‹œê°„
  
  // ê´€ë¦¬ì ì •ë³´
  sentBy            String         // ë°œì†¡í•œ ê´€ë¦¬ì ì´ë©”ì¼
  
  // ë©”íƒ€ë°ì´í„°
  metadata          Json?          // ì¶”ê°€ ë©”íƒ€ë°ì´í„° (ì„¸ê·¸ë¨¼íŠ¸ ì •ë³´ ë“±)
  errorLog          String?        @db.Text // ì—ëŸ¬ ë¡œê·¸
  
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  
  @@index([status])
  @@index([sentAt])
  @@index([targetType])
  @@index([templateId])
  @@map("email_campaign")
}

// ğŸ“§ ì´ë©”ì¼ ìˆ˜ì‹ ìë³„ ì¶”ì  ëª¨ë¸ (ìƒì„¸ ë¶„ì„ìš©)
model EmailRecipient {
  id                String         @id @default(uuid())
  
  campaignId        String         // ìº í˜ì¸ ID
  email             String         // ìˆ˜ì‹ ì ì´ë©”ì¼
  userId            String?        // ìˆ˜ì‹ ì ì‚¬ìš©ì ID (íšŒì›ì¸ ê²½ìš°)
  
  // ë°œì†¡ ìƒíƒœ
  status            EmailDeliveryStatus @default(pending) // ê°œë³„ ë°œì†¡ ìƒíƒœ
  sentAt            DateTime?      // ë°œì†¡ ì‹œê°„
  deliveredAt       DateTime?      // ë°°ë‹¬ ì‹œê°„
  
  // ì‚¬ìš©ì í–‰ë™ ì¶”ì 
  openedAt          DateTime?      // ì²« ì—´ëŒ ì‹œê°„
  openCount         Int            @default(0) // ì—´ëŒ íšŸìˆ˜
  lastOpenedAt      DateTime?      // ë§ˆì§€ë§‰ ì—´ëŒ ì‹œê°„
  
  clickedAt         DateTime?      // ì²« í´ë¦­ ì‹œê°„
  clickCount        Int            @default(0) // í´ë¦­ íšŸìˆ˜
  lastClickedAt     DateTime?      // ë§ˆì§€ë§‰ í´ë¦­ ì‹œê°„
  
  // ë°˜ì†¡/ì—ëŸ¬ ì •ë³´
  bounceReason      String?        // ë°˜ì†¡ ì‚¬ìœ 
  errorMessage      String?        // ì—ëŸ¬ ë©”ì‹œì§€
  
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  
  @@unique([campaignId, email])
  @@index([campaignId])
  @@index([email])
  @@index([userId])
  @@index([status])
  @@map("email_recipient")
}

// ì´ë©”ì¼ í…œí”Œë¦¿ ìœ í˜•
enum EmailType {
  marketing      // ë§ˆì¼€íŒ… ì´ë©”ì¼
  system         // ì‹œìŠ¤í…œ ì•Œë¦¼
  announcement   // ê³µì§€ì‚¬í•­
  welcome        // í™˜ì˜ ì´ë©”ì¼
  newsletter     // ë‰´ìŠ¤ë ˆí„°
  promotion      // í”„ë¡œëª¨ì…˜
}

// ì´ë©”ì¼ ë°œì†¡ ëŒ€ìƒ ìœ í˜•
enum EmailTargetType {
  all            // ì „ì²´ ì‚¬ìš©ì
  free           // ë¬´ë£Œ í”Œëœ ì‚¬ìš©ì
  paid           // ìœ ë£Œ í”Œëœ ì‚¬ìš©ì
  starter        // ìŠ¤íƒ€í„° í”Œëœ
  pro            // í”„ë¡œ í”Œëœ  
  premium        // í”„ë¦¬ë¯¸ì—„ í”Œëœ
  inactive       // ë¹„í™œì„± ì‚¬ìš©ì
  active         // í™œì„± ì‚¬ìš©ì
  custom         // ì»¤ìŠ¤í…€ ì´ë©”ì¼ ëª©ë¡
}

// ì´ë©”ì¼ ìº í˜ì¸ ìƒíƒœ
enum EmailStatus {
  pending        // ëŒ€ê¸° ì¤‘
  sending        // ë°œì†¡ ì¤‘
  sent           // ë°œì†¡ ì™„ë£Œ
  failed         // ë°œì†¡ ì‹¤íŒ¨
  cancelled      // ì·¨ì†Œë¨
  scheduled      // ì˜ˆì•½ë¨
}

// ê°œë³„ ì´ë©”ì¼ ë°°ë‹¬ ìƒíƒœ
enum EmailDeliveryStatus {
  pending        // ëŒ€ê¸° ì¤‘
  sent           // ë°œì†¡ë¨
  delivered      // ë°°ë‹¬ë¨
  bounced        // ë°˜ì†¡ë¨
  failed         // ì‹¤íŒ¨
  blocked        // ì°¨ë‹¨ë¨
}

// ğŸ’° í™˜ë¶ˆ ê´€ë¦¬ ëª¨ë¸
model Refund {
  id                String         @id @default(uuid())
  
  // í™˜ë¶ˆ ëŒ€ìƒ ì •ë³´
  userId            String         @map("user_id")
  user              User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  subscriptionId    String?        @map("subscription_id")
  subscription      Subscription?  @relation(fields: [subscriptionId], references: [id], onDelete: SetNull)
  
  transactionId     String?        @map("transaction_id")
  transaction       Transaction?   @relation(fields: [transactionId], references: [id], onDelete: SetNull)
  
  // í† ìŠ¤í˜ì´ë¨¼ì¸  ì •ë³´
  payToken          String         @map("pay_token")      // í† ìŠ¤í˜ì´ë¨¼ì¸  ê²°ì œ í† í°
  refundNo          String         @unique @map("refund_no") // í† ìŠ¤í˜ì´ë¨¼ì¸  í™˜ë¶ˆ ë²ˆí˜¸
  
  // í™˜ë¶ˆ ìƒì„¸ ì •ë³´
  refundAmount      Int            @map("refund_amount")  // í™˜ë¶ˆ ê¸ˆì•¡
  refundType        RefundType     @default(FULL) @map("refund_type") // í™˜ë¶ˆ ìœ í˜•
  reason            String         @db.Text              // í™˜ë¶ˆ ì‚¬ìœ 
  status            RefundStatus   @default(PENDING)     // í™˜ë¶ˆ ìƒíƒœ
  
  // ê´€ë¦¬ì ì •ë³´
  processedBy       String?        @map("processed_by")   // ì²˜ë¦¬í•œ ê´€ë¦¬ì ID
  processedAt       DateTime?      @map("processed_at")   // ì²˜ë¦¬ ì‹œê°„
  
  // í† ìŠ¤í˜ì´ë¨¼ì¸  ì‘ë‹µ ë°ì´í„°
  tossData          Json?          @map("toss_data")      // í† ìŠ¤í˜ì´ë¨¼ì¸  ì‘ë‹µ ì „ì²´ ë°ì´í„°
  
  // ì¶”ê°€ ë©”ëª¨
  adminNote         String?        @db.Text @map("admin_note") // ê´€ë¦¬ì ë©”ëª¨
  
  createdAt         DateTime       @default(now()) @map("created_at")
  updatedAt         DateTime       @updatedAt @map("updated_at")
  
  @@index([userId])
  @@index([refundNo])
  @@index([status])
  @@index([processedAt])
  @@index([createdAt])
  @@map("refund")
}

// í™˜ë¶ˆ ìœ í˜•
enum RefundType {
  FULL            // ì „ì•¡ í™˜ë¶ˆ
  PARTIAL         // ë¶€ë¶„ í™˜ë¶ˆ
}

// í™˜ë¶ˆ ìƒíƒœ
enum RefundStatus {
  PENDING         // ì²˜ë¦¬ ëŒ€ê¸°
  PROCESSING      // ì²˜ë¦¬ ì¤‘
  COMPLETED       // ì™„ë£Œ
  FAILED          // ì‹¤íŒ¨
  CANCELLED       // ì·¨ì†Œë¨
}

// í˜„ê¸ˆì˜ìˆ˜ì¦ ëª¨ë¸
model CashReceipt {
  id                    String                 @id @default(uuid())
  
  // ì—°ê´€ ê´€ê³„
  userId                String                 @map("user_id")
  user                  User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  transactionId         String                 @map("transaction_id")
  transaction           Transaction            @relation(fields: [transactionId], references: [id], onDelete: Cascade)
  
  // í† ìŠ¤í˜ì´ë¨¼ì¸  ì •ë³´
  payToken              String                 @map("pay_token")        // í† ìŠ¤í˜ì´ë¨¼ì¸  ê²°ì œ í† í°
  cashReceiptMgtKey     String?                @map("cash_receipt_mgt_key") // í˜„ê¸ˆì˜ìˆ˜ì¦ ê´€ë¦¬ë²ˆí˜¸
  
  // í˜„ê¸ˆì˜ìˆ˜ì¦ ìš”ì²­ ì •ë³´
  cashReceiptKey        String                 @map("cash_receipt_key")     // ì‹ë³„ì (íœ´ëŒ€í°, ì‚¬ì—…ìë²ˆí˜¸, ì¹´ë“œë²ˆí˜¸)
  cashReceiptKeyType    CashReceiptKeyType     @map("cash_receipt_key_type") // ì‹ë³„ì íƒ€ì…
  cashReceiptPurpose    CashReceiptPurpose     @map("cash_receipt_purpose")  // í˜„ê¸ˆì˜ìˆ˜ì¦ ìš©ë„
  
  // í˜„ê¸ˆì˜ìˆ˜ì¦ ìƒì„¸ ì •ë³´
  customerName          String?                @map("customer_name")
  itemName              String?                @map("item_name")
  identityNum           String?                @map("identity_num")
  taxationType          String?                @map("taxation_type")
  totalAmount           Int?                   @map("total_amount")
  supplyCost            Int?                   @map("supply_cost")
  tax                   Int?                   @map("tax")
  serviceFee            Int?                   @map("service_fee")
  tradeUsage            String?                @map("trade_usage")
  tradeType             String?                @map("trade_type")
  
  // ìƒíƒœ ë° ì²˜ë¦¬ ì •ë³´
  status                CashReceiptStatus      @default(PENDING)
  issueStatus           String?                @map("issue_status")      // í† ìŠ¤í˜ì´ë¨¼ì¸  ë°œê¸‰ ìƒíƒœ
  failureReason         String?                @map("failure_reason")     // ì‹¤íŒ¨ ì‚¬ìœ 
  
  // ìë™ ë°œê¸‰ ì„¤ì •
  autoIssue             Boolean                @default(false) @map("auto_issue")
  issueRequested        Boolean                @default(false) @map("issue_requested")
  
  // ì²˜ë¦¬ ì •ë³´
  issuedAt              DateTime?              @map("issued_at")
  revokedAt             DateTime?              @map("revoked_at")
  processedBy           String?                @map("processed_by")       // ì²˜ë¦¬í•œ ê´€ë¦¬ì ID
  
  // í† ìŠ¤í˜ì´ë¨¼ì¸  ì‘ë‹µ ë°ì´í„°
  tossResponseData      Json?                  @map("toss_response_data")
  
  // íŒì—… URI
  popupUri              String?                @map("popup_uri")
  
  createdAt             DateTime               @default(now()) @map("created_at")
  updatedAt             DateTime               @updatedAt @map("updated_at")
  
  @@unique([transactionId])
  @@index([userId])
  @@index([payToken])
  @@index([status])
  @@index([cashReceiptKeyType])
  @@index([autoIssue])
  @@index([createdAt])
  @@map("cash_receipt")
}

// í˜„ê¸ˆì˜ìˆ˜ì¦ ì‹ë³„ì íƒ€ì…
enum CashReceiptKeyType {
  PHONE       // íœ´ëŒ€í° ë²ˆí˜¸
  CORPORATE   // ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸
  CARD        // í˜„ê¸ˆì˜ìˆ˜ì¦ ì¹´ë“œ
}

// í˜„ê¸ˆì˜ìˆ˜ì¦ ìš©ë„
enum CashReceiptPurpose {
  DEDUCTION   // ì†Œë“ê³µì œ (ê°œì¸)
  EVIDENCE    // ì§€ì¶œì¦ë¹™ (ì‚¬ì—…ì)
}

// í˜„ê¸ˆì˜ìˆ˜ì¦ ìƒíƒœ
enum CashReceiptStatus {
  PENDING           // ë°œê¸‰ ëŒ€ê¸°
  REQUESTED         // ë°œê¸‰ ìš”ì²­ë¨
  IN_PROGRESS       // êµ­ì„¸ì²­ ì „ì†¡ ì¤‘
  ISSUE_APPLIED     // ë°œê¸‰ ì‹ ì²­ ì™„ë£Œ
  ISSUE_COMPLETE    // ë°œê¸‰ ì™„ë£Œ
  ISSUE_FAILED      // ë°œê¸‰ ì‹¤íŒ¨
  REVOKED           // ì·¨ì†Œë¨
  ERROR             // ì˜¤ë¥˜
}

// ì‚¬ìš©ì í˜„ê¸ˆì˜ìˆ˜ì¦ ì„¤ì • ëª¨ë¸
model UserCashReceiptSettings {
  id                    String                 @id @default(uuid())
  
  // ì‚¬ìš©ì ê´€ê³„
  userId                String                 @unique @map("user_id")
  user                  User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // í˜„ê¸ˆì˜ìˆ˜ì¦ ì„¤ì •
  cashReceiptKey        String                 @map("cash_receipt_key")     // ì‹ë³„ì (íœ´ëŒ€í°, ì‚¬ì—…ìë²ˆí˜¸, ì¹´ë“œë²ˆí˜¸)
  cashReceiptKeyType    CashReceiptKeyType     @map("cash_receipt_key_type") // ì‹ë³„ì íƒ€ì…
  cashReceiptPurpose    CashReceiptPurpose     @map("cash_receipt_purpose")  // í˜„ê¸ˆì˜ìˆ˜ì¦ ìš©ë„
  
  // ìë™ ë°œê¸‰ ì„¤ì •
  autoIssue             Boolean                @default(true) @map("auto_issue")
  isActive              Boolean                @default(true) @map("is_active")
  
  // ì„¤ì • ë©”íƒ€ë°ì´í„°
  lastUsed              DateTime?              @map("last_used")
  
  createdAt             DateTime               @default(now()) @map("created_at")
  updatedAt             DateTime               @updatedAt @map("updated_at")
  
  @@index([userId])
  @@index([autoIssue])
  @@index([isActive])
  @@map("user_cash_receipt_settings")
}

// ë°°ì¹˜ ìƒì„± ì‘ì—… ëª¨ë¸
model BatchGenerationJob {
  id                    String                 @id @default(uuid())
  
  // ì—°ê´€ ê´€ê³„
  userId                String                 @map("user_id")
  user                  User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  projectId             String                 @map("project_id")
  project               Project                @relation(fields: [projectId], references: [id], onDelete: Cascade)
  
  // ì‘ì—… ìƒíƒœ
  status                BatchJobStatus         @default(PENDING)
  
  // ì§„í–‰ ìƒí™©
  totalPanels           Int                    @map("total_panels")
  completedPanels       Int                    @default(0) @map("completed_panels")
  currentPanelIndex     Int?                   @map("current_panel_index")
  
  // ì„¤ì •
  canvasRatio           String                 @map("canvas_ratio") // '1:1' or '4:5'
  scriptData            Json                   @map("script_data") // ëŒ€ë³¸ íŒ¨ë„ ë°ì´í„°
  
  // ê²°ê³¼
  generatedImages       Json                   @default("[]") @map("generated_images")
  failedPanels          Json                   @default("[]") @map("failed_panels")
  totalTokensUsed       Int                    @default(0) @map("total_tokens_used")
  
  // ì˜¤ë¥˜ ì •ë³´
  errorMessage          String?                @map("error_message")
  errorDetails          Json?                  @map("error_details")
  
  // íƒ€ì„ìŠ¤íƒ¬í”„
  startedAt             DateTime?              @map("started_at")
  completedAt           DateTime?              @map("completed_at")
  createdAt             DateTime               @default(now()) @map("created_at")
  updatedAt             DateTime               @updatedAt @map("updated_at")
  
  // ê´€ê³„
  panelResults          BatchPanelResult[]
  
  @@index([userId])
  @@index([projectId])
  @@index([status])
  @@index([createdAt])
  @@map("batch_generation_job")
}

// ë°°ì¹˜ ì‘ì—…ë³„ íŒ¨ë„ ìƒì„± ê²°ê³¼ ëª¨ë¸
model BatchPanelResult {
  id                    String                 @id @default(uuid())
  
  // ì—°ê´€ ê´€ê³„
  batchJobId            String                 @map("batch_job_id")
  batchJob              BatchGenerationJob     @relation(fields: [batchJobId], references: [id], onDelete: Cascade)
  
  panelId               String?                @map("panel_id")
  panel                 Panel?                 @relation(fields: [panelId], references: [id], onDelete: SetNull)
  
  panelOrder            Int                    @map("panel_order")
  
  // ìƒì„± ìƒíƒœ
  status                PanelStatus            @default(PENDING)
  
  // ìƒì„± ê²°ê³¼
  imageUrl              String?                @map("image_url")
  generationId          String?                @map("generation_id")
  generation            Generation?            @relation(fields: [generationId], references: [id], onDelete: SetNull)
  tokensUsed            Int                    @default(0) @map("tokens_used")
  
  // í”„ë¡¬í”„íŠ¸ì™€ ì„¤ì •
  prompt                String
  characters            Json                   @default("[]")
  elements              Json                   @default("[]")
  
  // ì˜¤ë¥˜ ì •ë³´
  errorMessage          String?                @map("error_message")
  retryCount            Int                    @default(0) @map("retry_count")
  
  // íƒ€ì„ìŠ¤íƒ¬í”„
  startedAt             DateTime?              @map("started_at")
  completedAt           DateTime?              @map("completed_at")
  createdAt             DateTime               @default(now()) @map("created_at")
  updatedAt             DateTime               @updatedAt @map("updated_at")
  
  @@unique([batchJobId, panelOrder])
  @@index([batchJobId])
  @@index([status])
  @@index([panelOrder])
  @@map("batch_panel_result")
}

// ë°°ì¹˜ ì‘ì—… ìƒíƒœ ì—´ê±°í˜•
enum BatchJobStatus {
  PENDING           // ëŒ€ê¸° ì¤‘
  IN_PROGRESS       // ì§„í–‰ ì¤‘
  COMPLETED         // ì™„ë£Œ
  FAILED            // ì‹¤íŒ¨
  CANCELLED         // ì·¨ì†Œë¨
}

// íŒ¨ë„ ìƒíƒœ ì—´ê±°í˜•
enum PanelStatus {
  PENDING           // ëŒ€ê¸° ì¤‘
  IN_PROGRESS       // ì§„í–‰ ì¤‘
  COMPLETED         // ì™„ë£Œ
  FAILED            // ì‹¤íŒ¨
  SKIPPED           // ê±´ë„ˆëœ€
}

// ğŸš€ ì‹¤ì„œë¹„ìŠ¤ìš© í”„ë¡œì íŠ¸ ì»¨í…ìŠ¤íŠ¸ í…Œì´ë¸”
model ProjectContext {
  id                    String                 @id @default(uuid())
  projectId             String                 @map("project_id")
  userId                String                 @map("user_id")
  
  // ğŸ­ Gemini ì›¹íˆ° ì—°ì†ì„± ì»¨í…ìŠ¤íŠ¸ (JSON í˜•íƒœ) - ìµœìš°ì„ 
  webtoonPanelContext   String?                @map("webtoon_panel_context") @db.Text
  
  // ğŸ§  ê³ ê¸‰ ì›¹íˆ° ì»¨í…ìŠ¤íŠ¸ (JSON í˜•íƒœ) - í•˜ìœ„ í˜¸í™˜ì„±
  webtoonContext        String                 @default("{}") @map("webtoon_context") @db.Text
  
  // ì••ì¶•ëœ ì»¨í…ìŠ¤íŠ¸ ë°ì´í„° (í† í° ì ˆì•½) - í•˜ìœ„ í˜¸í™˜ì„±
  storyContext          String                 @default("") @map("story_context") @db.VarChar(800)
  recentPanels          String                 @default("") @map("recent_panels") @db.VarChar(500)
  
  // ë©”íƒ€ë°ì´í„°
  panelCount            Int                    @default(0) @map("panel_count")
  tokenUsage            Int                    @default(0) @map("token_usage")
  
  // íƒ€ì„ìŠ¤íƒ¬í”„ì™€ ë§Œë£Œ
  lastUpdated           DateTime               @default(now()) @map("last_updated")
  expiresAt             DateTime               @map("expires_at")
  createdAt             DateTime               @default(now()) @map("created_at")
  
  // ê´€ê³„
  user                  User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  project               Project                @relation(fields: [projectId], references: [id], onDelete: Cascade)
  
  // ì¸ë±ìŠ¤
  @@unique([projectId, userId])
  @@index([userId])
  @@index([projectId])
  @@index([expiresAt]) // ë§Œë£Œëœ ì»¨í…ìŠ¤íŠ¸ ì •ë¦¬ìš©
  @@map("project_context")
}